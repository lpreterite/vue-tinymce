{"version":3,"file":"bundle.js","sources":["../../dist/vue-tinymce.esm.js","../main.js"],"sourcesContent":["import { h } from 'vue';\n\nconst INIT = 0;\r\nconst INPUT = 1;\r\n\r\nconst status = ['INIT', 'INPUT', 'CHANGED'];\r\nconst changedLog = debug=>{\r\n    if(!debug) return ()=>false\r\n    console.warn(\"`@packy-tang/vue-tinymce`进入debug模式\");\r\n    return (e, _status, val, oldVal)=>console.log(`来自：%s | 状态：%s \\n %s \\n %s`, e.type, status[_status], val, oldVal)\r\n};\r\n\r\nvar script = {\r\n    name: \"VueTinymce\",\r\n    model: {\r\n        prop: \"content\",\r\n        event: \"change\"\r\n    },\r\n    props: {\r\n        content: {\r\n            type: [String, Object],\r\n            default: ''\r\n        },\r\n        setup: {\r\n            type: Function,\r\n            default: function(){}\r\n        },\r\n        disabled: {\r\n            type: Boolean,\r\n            default: false\r\n        },\r\n        setting: {\r\n            type: Object,\r\n            default: function(){ \r\n                return {};\r\n            }\r\n        },\r\n        debug: Boolean\r\n    },\r\n    render(){\r\n        if(typeof tinymce === \"undefined\"){\r\n            return h('div', \"tinymce is undefined\"); \r\n        }\r\n        return h('div', {\r\n            attrs: {\r\n                id: this.id\r\n            }\r\n        });\r\n    },\r\n    data(){\r\n        return {\r\n            id: 'vue-tinymce-'+Date.now()+Math.floor(Math.random() * 1000),\r\n            editor: null,\r\n            status: INIT,\r\n            bookmark: null\r\n        }\r\n    },\r\n    watch: {\r\n        content(val, oldVal){\r\n            this.changedLog({ type: \"propsChanged\" }, this.status, `${val} | ${oldVal}`, \"--\");\r\n            if(this.status === INPUT || oldVal === val) return;\r\n            if(!this.editor || !this.editor.initialized) return; // fix editor plugin is loading and set content will throw error.\r\n            if(val === null) return this.resetContent(\"\");\r\n            this.setContent(val);\r\n        },\r\n        disabled(val){\r\n            this.editor.setMode(val?\"readonly\":\"design\");\r\n        }\r\n    },\r\n    created(){\r\n        this.changedLog = changedLog(this.debug);\r\n        if(typeof tinymce === \"undefined\") throw new Error('tinymce undefined');\r\n    },\r\n    beforeMount () {\r\n        const setting = Object.assign({},\r\n            this.setting,\r\n            {\r\n                selector: '#'+this.id,\r\n                setup: (editor)=> {\r\n                    this.setup(editor);\r\n                    // console.log('setup');\r\n                    editor.on('init', ()=>{\r\n                        // console.log('init', this.content);\r\n                        this.setContent(this.content, editor);\r\n                        editor.on('keyup input', e=>{ //只在编辑器中打字才会触发\r\n                            this.status = INPUT;       //编辑器录入文字时标记为`INPUT`状态\r\n                        });\r\n                        editor.on('SetContent', e=>{ //编辑器在插入图片和撤销/重做时触发，组件content更新数据也会导致触发\r\n                            this.changedLog(e, this.status, editor.getContent(), \"--\");\r\n                        });\r\n                        editor.on('Blur', e=>{\r\n                            this.status = INIT;\r\n                            this.changedLog(e, this.status, editor.getContent(), \"--\");\r\n                        });\r\n                        editor.on('input keyup Change Undo Redo ExecCommand NodeChange', e=>{\r\n                            this.onChanged(e, editor);\r\n                        });\r\n                    });\r\n                }\r\n            }\r\n        );\r\n        this.editor = tinymce.createEditor(setting.selector, setting);\r\n    },\r\n    mounted(){\r\n        this.editor.targetElm = this.$el;\r\n        this.editor.render();\r\n    },\r\n    updated () {\r\n        this.editor.render();\r\n    },\r\n    beforeDestroy: function(){\r\n        this.editor.remove();\r\n    },\r\n    methods: {\r\n        setContent(val, editor){\r\n            if(!editor) editor = this.editor;\r\n            editor.setContent(val);\r\n            editor.selection.moveToBookmark(this.bookmark);\r\n        },\r\n        resetContent(val, editor){\r\n            if(!editor) editor = this.editor;\r\n            if(!!editor.resetContent) return editor.resetContent(val)\r\n            editor.setContent(val);\r\n            editor.setDirty(false);\r\n            editor.undoManager.clear();\r\n        },\r\n        onChanged(e, editor){\r\n            if(!editor) editor = this.editor;\r\n            if(e.type === 'change') this.bookmark = e.level.bookmark;\r\n            const content = editor.getContent();\r\n            this.changedLog(e, this.status, content, \"--\");\r\n            this.$emit('change', content);\r\n        }\r\n    }\r\n};\n\nfunction normalizeComponent(template, style, script, scopeId, isFunctionalTemplate, moduleIdentifier /* server only */, shadowMode, createInjector, createInjectorSSR, createInjectorShadow) {\r\n    if (typeof shadowMode !== 'boolean') {\r\n        createInjectorSSR = createInjector;\r\n        createInjector = shadowMode;\r\n        shadowMode = false;\r\n    }\r\n    // Vue.extend constructor export interop.\r\n    const options = typeof script === 'function' ? script.options : script;\r\n    // render functions\r\n    if (template && template.render) {\r\n        options.render = template.render;\r\n        options.staticRenderFns = template.staticRenderFns;\r\n        options._compiled = true;\r\n        // functional template\r\n        if (isFunctionalTemplate) {\r\n            options.functional = true;\r\n        }\r\n    }\r\n    // scopedId\r\n    if (scopeId) {\r\n        options._scopeId = scopeId;\r\n    }\r\n    let hook;\r\n    if (moduleIdentifier) {\r\n        // server build\r\n        hook = function (context) {\r\n            // 2.3 injection\r\n            context =\r\n                context || // cached call\r\n                    (this.$vnode && this.$vnode.ssrContext) || // stateful\r\n                    (this.parent && this.parent.$vnode && this.parent.$vnode.ssrContext); // functional\r\n            // 2.2 with runInNewContext: true\r\n            if (!context && typeof __VUE_SSR_CONTEXT__ !== 'undefined') {\r\n                context = __VUE_SSR_CONTEXT__;\r\n            }\r\n            // inject component styles\r\n            if (style) {\r\n                style.call(this, createInjectorSSR(context));\r\n            }\r\n            // register component module identifier for async chunk inference\r\n            if (context && context._registeredComponents) {\r\n                context._registeredComponents.add(moduleIdentifier);\r\n            }\r\n        };\r\n        // used by ssr in case component is cached and beforeCreate\r\n        // never gets called\r\n        options._ssrRegister = hook;\r\n    }\r\n    else if (style) {\r\n        hook = shadowMode\r\n            ? function (context) {\r\n                style.call(this, createInjectorShadow(context, this.$root.$options.shadowRoot));\r\n            }\r\n            : function (context) {\r\n                style.call(this, createInjector(context));\r\n            };\r\n    }\r\n    if (hook) {\r\n        if (options.functional) {\r\n            // register for functional component in vue file\r\n            const originalRender = options.render;\r\n            options.render = function renderWithStyleInjection(h, context) {\r\n                hook.call(context);\r\n                return originalRender(h, context);\r\n            };\r\n        }\r\n        else {\r\n            // inject component registration as beforeCreate hook\r\n            const existing = options.beforeCreate;\r\n            options.beforeCreate = existing ? [].concat(existing, hook) : [hook];\r\n        }\r\n    }\r\n    return script;\r\n}\n\n/* script */\nconst __vue_script__ = script;\n\n/* template */\n\n  /* style */\n  const __vue_inject_styles__ = undefined;\n  /* scoped */\n  const __vue_scope_id__ = undefined;\n  /* module identifier */\n  const __vue_module_identifier__ = undefined;\n  /* functional template */\n  const __vue_is_functional_template__ = undefined;\n  /* style inject */\n  \n  /* style inject SSR */\n  \n  /* style inject shadow dom */\n  \n\n  \n  const __vue_component__ = /*#__PURE__*/normalizeComponent(\n    {},\n    __vue_inject_styles__,\n    __vue_script__,\n    __vue_scope_id__,\n    __vue_is_functional_template__,\n    __vue_module_identifier__,\n    false,\n    undefined,\n    undefined,\n    undefined\n  );\n\nclass VuePlugin{\r\n    constructor(){\r\n        const { prefix } = { prefix: \"\" };\r\n        this.prefix = prefix;\r\n    }\r\n    install(Vue, options={}){\r\n        const prefix = options.prefix || this.prefix;\r\n        const components = {\r\n            VueTinymce: __vue_component__\r\n        };\r\n        Object.keys(components).forEach(key => {\r\n            const component = components[key];\r\n            Vue.component(prefix+component.name, component);\r\n        });\r\n    }\r\n}\r\nvar main = new VuePlugin();\n\nexport { __vue_component__ as VueTinymce, main as default };\n//# sourceMappingURL=vue-tinymce.esm.js.map\n","import Vue from \"vue\"\r\nimport VueTinymce from \"..\"\r\n\r\nVue.use(VueTinymce)"],"names":["status","normalizeComponent","template","style","script","scopeId","isFunctionalTemplate","moduleIdentifier","shadowMode","createInjector","createInjectorSSR","createInjectorShadow","options","hook","render","staticRenderFns","_compiled","functional","_scopeId","context","this","$vnode","ssrContext","parent","__VUE_SSR_CONTEXT__","call","_registeredComponents","add","_ssrRegister","$root","$options","shadowRoot","originalRender","h","existing","beforeCreate","concat","__vue_component__","undefined","name","model","prop","event","props","content","type","String","Object","default","setup","Function","disabled","Boolean","setting","debug","tinymce","attrs","id","data","Date","now","Math","floor","random","editor","bookmark","watch","val","oldVal","changedLog","initialized","resetContent","setContent","setMode","created","console","warn","e","_status","log","Error","beforeMount","assign","selector","on","getContent","onChanged","createEditor","mounted","targetElm","$el","updated","beforeDestroy","remove","methods","selection","moveToBookmark","setDirty","undoManager","clear","level","$emit","main","constructor","prefix","install","Vue","components","VueTinymce","keys","forEach","key","component","Vue__default","use"],"mappings":"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"}